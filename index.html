<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô ‚Äì ‡∏Ñ‡∏£‡∏π‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≠‡∏ô</title>
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Prompt -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* Use Prompt font as the primary font */
        body {
            font-family: 'Prompt', sans-serif;
            background-color: #FEFBF6; /* Creamy white background */
        }

        /* CSS for printing */
        @media print {
            /* Hide elements not meant for printing */
            .print-hide {
                display: none !important;
            }
            /* Show the dedicated print header */
            .print-show {
                display: block !important;
            }
            /* Page settings */
            @page {
                size: A4;
                margin: 0.75in;
            }
            body {
                background-color: #ffffff;
                margin: 0;
                padding: 0;
            }
            .main-container {
                box-shadow: none;
                border: none;
                padding: 0;
                margin: 0;
                width: 100%;
                max-width: 100%;
            }
            /* Hide control buttons in rows */
            .subject-row .print-hide-controls {
                display: none;
            }
            /* Make inputs/selects look like plain text */
            .subject-row input,
            .subject-row select {
                border: none;
                padding: 0;
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                background: transparent;
                pointer-events: none;
            }
             /* Adjust summary grid for printing */
            .summary-grid {
                grid-template-columns: 2fr 1fr;
            }
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Datalist for subject suggestions -->
    <!-- ‡∏à‡∏∏‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏° datalist ‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ -->
    <datalist id="subjectList">
        <option value="‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢"></option>
        <option value="‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©"></option>
        <option value="‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"></option>
        <option value="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°"></option>
        <option value="‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏â‡∏•‡∏≤‡∏î‡∏£‡∏π‡πâ"></option>
        <option value="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì"></option>
        <option value="‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á"></option>
        <option value="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"></option>
        <option value="‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô"></option>
        <option value="‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏à‡∏¥‡∏ï"></option>
        <option value="‡∏®‡∏¥‡∏•‡∏õ‡∏∞‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡∏†‡∏≤‡∏û"></option>
        <option value="‡∏û‡∏•‡∏®‡∏∂‡∏Å‡∏©‡∏≤"></option>
        <option value="‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û"></option>
        <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ"></option>
    </datalist>

    <!-- Template for creating new subject rows (hidden) -->
    <template id="subjectRowTemplate">
        <div class="subject-row grid grid-cols-12 gap-2 items-center mb-2 p-2 rounded-lg bg-white shadow-sm"
            data-id="">
            <!-- Subject Name Input -->
            <div class="col-span-12 md:col-span-4">
                <input type="text" list="subjectList" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô/‡∏ß‡∏¥‡∏ä‡∏≤"
                    class="subject-name-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400" oninput="handleSelectionChange(this)">
            </div>
            <!-- Grade Selection -->
            <div class="col-span-6 md:col-span-2">
                <select class="subject-grade-select w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400" onchange="handleSelectionChange(this)">
                    <option value="none">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô</option>
                    <option value="p1">‡∏õ.1</option>
                    <option value="p2">‡∏õ.2</option>
                    <option value="p3">‡∏õ.3</option>
                </select>
            </div>
            <!-- Hours Selection -->
            <div class="col-span-6 md:col-span-2">
                <select
                    class="subject-hours-select w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400"
                    onchange="recalcTotals()">
                    <!-- Options are dynamically populated by JS -->
                </select>
            </div>
            <!-- Package Price Display -->
            <div class="col-span-6 md:col-span-2">
                <span
                    class="subject-price-display text-gray-700 font-medium text-right w-full block pr-2">0 ‡∏ö‡∏≤‡∏ó</span>
            </div>
            <!-- Row Controls -->
            <div class="col-span-6 md:col-span-2 flex gap-2 print-hide-controls">
                <button type="button"
                    class="duplicate-btn w-full text-sm bg-blue-100 text-blue-700 px-3 py-2 rounded-md hover:bg-blue-200">
                    ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                </button>
                <button type="button"
                    class="remove-btn w-full text-sm bg-red-100 text-red-700 px-3 py-2 rounded-md hover:bg-red-200">
                    ‡∏•‡∏ö
                </button>
            </div>
        </div>
    </template>


    <!-- Main App Container -->
    <div class="main-container container mx-auto p-4 md:p-8 max-w-4xl">

        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-gray-900">‡∏Ñ‡∏£‡∏π‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≠‡∏ô‚Ñ¢</h1>
            <p class="text-xl text-gray-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</p>
        </header>

        <!-- Header for Printing (Initially Hidden) -->
        <div class="print-show hidden mb-6 border-b pb-4">
            <h1 class="text-2xl font-bold">‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</h1>
            <p class="text-lg">‡πÇ‡∏î‡∏¢: ‡∏Ñ‡∏£‡∏π‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≠‡∏ô‚Ñ¢</p>
            <div class="mt-2 text-sm">
                <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="printDate"></span></p>
            </div>
        </div>

        <!-- Quick Add Panel -->
        <fieldset class="my-4 p-4 border rounded-lg bg-white shadow-sm print-hide">
            <legend class="text-lg font-semibold px-2">‡πÅ‡∏ú‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏ö‡∏ö‡∏î‡πà‡∏ß‡∏ô</legend>
            <div id="quickAddPanel" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 mt-2">
                <!-- Checkboxes will be populated by JS -->
            </div>
            <button type="button" onclick="bulkAddSelectedSubjects()"
                class="mt-4 w-full bg-yellow-200 text-yellow-800 font-semibold px-4 py-2 rounded-md hover:bg-yellow-300 transition-colors">
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            </button>
        </fieldset>

        <!-- Subjects List Table -->
        <div class="mb-4 print-hide">
            <h2 class="text-xl font-semibold mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</h2>
            <div class="hidden md:grid grid-cols-12 gap-2 text-sm font-semibold text-gray-600 px-2 mb-1">
                <div class="col-span-4">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</div>
                <div class="col-span-2">‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
                <div class="col-span-2">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</div>
                <div class="col-span-2 text-right">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à</div>
                <div class="col-span-2 text-center print-hide">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</div>
            </div>
            <div id="subjectListContainer">
                <!-- Subject rows will be added here -->
            </div>
            <button type="button" onclick="addRow()"
                class="mt-2 w-full md:w-auto bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors print-hide">
                + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤
            </button>
        </div>

        <!-- Review List -->
        <div id="reviewSection" class="mb-6 bg-white p-4 md:p-6 rounded-lg shadow-lg hidden">
            <h2 class="text-xl font-semibold mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</h2>
            <div id="reviewListContainer" class="space-y-2">
                <!-- Summary items will be populated here by JS -->
            </div>
        </div>

        <!-- Price Summary & Discounts -->
        <div class="mt-6 bg-white p-4 md:p-6 rounded-lg shadow-lg">
            <h2 class="text-xl font-semibold mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Discount Inputs -->
                <div class="space-y-4 print-hide">
                    <div>
                        <label for="discountPercent" class="block text-sm font-medium text-gray-700">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (%)</label>
                        <input type="number" id="discountPercent" min="0" max="100" placeholder="0"
                            oninput="recalcTotals()"
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-yellow-400">
                    </div>
                    <div>
                        <label for="discountBaht" class="block text-sm font-medium text-gray-700">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="discountBaht" min="0" placeholder="0" oninput="recalcTotals()"
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-yellow-400">
                    </div>
                </div>
                <!-- Price Display -->
                <div class="summary-grid grid grid-cols-2 gap-x-4 gap-y-2 text-right bg-gray-50 p-4 rounded-lg md:col-start-2">
                    <span class="text-gray-600 text-left">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î:</span>
                    <span id="subtotalDisplay" class="font-semibold text-gray-800">0 ‡∏ö‡∏≤‡∏ó</span>

                    <span class="text-gray-600 text-left">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (‡∏à‡∏≤‡∏Å %):</span>
                    <span id="discountPercentValueDisplay" class="font-semibold text-red-600">- 0 ‡∏ö‡∏≤‡∏ó</span>

                    <span class="text-gray-600 text-left">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≤‡∏ó):</span>
                    <span id="discountBahtValueDisplay" class="font-semibold text-red-600">- 0 ‡∏ö‡∏≤‡∏ó</span>

                    <span
                        class="text-left text-xl font-bold text-gray-900 border-t pt-2 mt-2 col-span-2"></span>
                    
                    <span
                        class="text-left text-xl font-bold text-gray-900">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</span>
                    <span id="netTotalDisplay"
                        class="text-right text-3xl font-bold text-blue-600">0 ‡∏ö‡∏≤‡∏ó</span>
                </div>
            </div>
        </div>

        <!-- Main Action Buttons -->
        <div class="mt-6 flex flex-col md:flex-row gap-4 print-hide">
            <button type="button" onclick="printQuote()"
                class="w-full bg-green-500 text-white font-semibold px-6 py-3 rounded-md hover:bg-green-600 transition-colors shadow-md">
                üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå / ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF
            </button>
            <button type="button" onclick="resetForm()"
                class="w-full bg-gray-400 text-white font-semibold px-6 py-3 rounded-md hover:bg-gray-500 transition-colors shadow-md">
                üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            </button>
        </div>

        <!-- Footer -->
        <footer class="text-center text-xs text-gray-500 mt-8 print-hide">
            ¬© 2025 ‡∏Ñ‡∏£‡∏π‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≠‡∏ô‚Ñ¢ | ‡∏Ñ‡∏£‡∏π‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏∑‡πà‡∏≠‚Ñ¢
            <br>‡∏´‡πâ‡∏≤‡∏°‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏±‡∏î‡πÅ‡∏õ‡∏•‡∏á‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
        </footer>
    </div>


    <script>
        // --- JavaScript Section ---

        // Price table object
        const priceTable = { 40: 200, 80: 250, 160: 300, 200: 350 };
        // List of subjects from datalist
        const subjectNames = [
            "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢", "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", "‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°",
            "‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏â‡∏•‡∏≤‡∏î‡∏£‡∏π‡πâ", "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì", "‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á",
            "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô", "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏à‡∏¥‡∏ï",
            "‡∏®‡∏¥‡∏•‡∏õ‡∏∞‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡∏†‡∏≤‡∏û", "‡∏û‡∏•‡∏®‡∏∂‡∏Å‡∏©‡∏≤", "‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û"
        ];
        
        // Configuration for dynamic hours based on subject and grade
        const subjectHoursConfig = {
            '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢': { 'p1': [200], 'p2': [200], 'p3': [160, 200] },
            '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©': { 'p1': [160, 200], 'p2': [160], 'p3': [160] },
            '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': { 'p1': [200], 'p2': [200], 'p3': [200] },
            '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°': { 'p1': [40], 'p2': [80], 'p3': [80] },
            '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏â‡∏•‡∏≤‡∏î‡∏£‡∏π‡πâ': { 'p1': [40], 'p2': [40], 'p3': [40] },
            '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì': { 'p1': [40], 'p2': [40], 'p3': [40] },
            '‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á': { 'p1': [40, 80], 'p2': [40, 80], 'p3': [80] },
            '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': { 'p1': [40], 'p2': [40], 'p3': [40] },
            '‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô': { 'p1': [40, 80], 'p2': [80], 'p3': [40] },
            '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏à‡∏¥‡∏ï': { 'p1': [40], 'p2': [40], 'p3': [80] },
            '‡∏®‡∏¥‡∏•‡∏õ‡∏∞‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡∏†‡∏≤‡∏û': { 'p1': [40], 'p2': [40], 'p3': [80] },
            '‡∏û‡∏•‡∏®‡∏∂‡∏Å‡∏©‡∏≤': { 'p1': [40], 'p2': [40], 'p3': [40] },
            '‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û': { 'p1': [40], 'p2': [40], 'p3': [40] }
        };

        let rowCounter = 0; // Unique ID counter for rows

        // --- DOM Elements ---
        const subjectListContainer = document.getElementById('subjectListContainer');
        const rowTemplate = document.getElementById('subjectRowTemplate');
        const quickAddPanel = document.getElementById('quickAddPanel');
        
        // Price Summary DOM Elements
        const discountPercentInput = document.getElementById('discountPercent');
        const discountBahtInput = document.getElementById('discountBaht');
        const subtotalDisplay = document.getElementById('subtotalDisplay');
        const discountPercentValueDisplay = document.getElementById('discountPercentValueDisplay');
        const discountBahtValueDisplay = document.getElementById('discountBahtValueDisplay');
        const netTotalDisplay = document.getElementById('netTotalDisplay');

        // --- Helper Functions ---
        
        function formatCurrency(value) {
            return new Intl.NumberFormat('th-TH').format(Math.round(value));
        }

        function getPrice(hours) {
            return priceTable[hours] || 0;
        }

        // --- Core Application Functions ---

        /**
         * Updates the hours dropdown based on the selected subject and grade.
         * @param {HTMLElement} row The row element to update.
         */
        function updateHoursOptions(row) {
            const subjectName = row.querySelector('.subject-name-input').value;
            const grade = row.querySelector('.subject-grade-select').value;
            const hoursSelect = row.querySelector('.subject-hours-select');
            
            const defaultHours = [40, 80, 160, 200];
            let availableHours = defaultHours;

            // Check if a specific configuration exists
            if (subjectHoursConfig[subjectName] && subjectHoursConfig[subjectName][grade]) {
                availableHours = subjectHoursConfig[subjectName][grade];
            }

            const currentSelectedHour = hoursSelect.value;
            hoursSelect.innerHTML = ''; // Clear existing options

            availableHours.forEach(hour => {
                const option = document.createElement('option');
                option.value = hour;
                option.textContent = `${hour} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á`;
                hoursSelect.appendChild(option);
            });

            // Try to re-select the previous hour if it's still available
            if (availableHours.includes(parseInt(currentSelectedHour))) {
                hoursSelect.value = currentSelectedHour;
            }
        }

        /**
         * Handles changes in subject name or grade to update hours and totals.
         * @param {HTMLElement} element The input or select element that triggered the change.
         */
        function handleSelectionChange(element) {
            const row = element.closest('.subject-row');
            updateHoursOptions(row);
            recalcTotals();
        }
        
        function addRow(subjectName = '', hours = 40, grade = 'none', skipRecalc = false) {
            rowCounter++;
            const rowId = `row-${rowCounter}`;

            const templateContent = rowTemplate.content.cloneNode(true);
            const newRow = templateContent.querySelector('.subject-row');
            newRow.id = rowId;

            const nameInput = newRow.querySelector('.subject-name-input');
            const gradeSelect = newRow.querySelector('.subject-grade-select');
            const hoursSelect = newRow.querySelector('.subject-hours-select');
            const duplicateBtn = newRow.querySelector('.duplicate-btn');
            const removeBtn = newRow.querySelector('.remove-btn');

            nameInput.value = subjectName;
            gradeSelect.value = grade;
            
            duplicateBtn.onclick = () => duplicateRow(rowId);
            removeBtn.onclick = () => removeRow(rowId);

            subjectListContainer.appendChild(newRow);
            
            // Update hours options before setting the value
            updateHoursOptions(newRow);
            hoursSelect.value = hours; // Set the hours after options are populated
            
            if (!skipRecalc) {
                recalcTotals();
            }
        }
        
        function duplicateRow(id) {
            const rowToDuplicate = document.getElementById(id);
            if (!rowToDuplicate) return;

            const name = rowToDuplicate.querySelector('.subject-name-input').value;
            const grade = rowToDuplicate.querySelector('.subject-grade-select').value;
            const hours = rowToDuplicate.querySelector('.subject-hours-select').value;

            addRow(name, hours, grade);
        }
        
        function removeRow(id) {
            const rowToRemove = document.getElementById(id);
            if (rowToRemove) {
                rowToRemove.remove();
                recalcTotals();
            }
        }
        
        function bulkAddSelectedSubjects() {
            const checkboxes = quickAddPanel.querySelectorAll('input[type="checkbox"]:checked');
            let added = false;
            checkboxes.forEach(cb => {
                addRow(cb.value, 40, 'none', true); // skip recalc
                cb.checked = false;
                added = true;
            });

            if (added) {
                recalcTotals();
            }
        }
        
        function recalcTotals() {
            let subtotal = 0;
            const allRows = subjectListContainer.querySelectorAll('.subject-row');
            const reviewSection = document.getElementById('reviewSection');
            const reviewListContainer = document.getElementById('reviewListContainer');

            reviewListContainer.innerHTML = '';

            allRows.forEach(row => {
                const hoursSelect = row.querySelector('.subject-hours-select');
                const priceDisplay = row.querySelector('.subject-price-display');
                const nameInput = row.querySelector('.subject-name-input');
                const gradeSelect = row.querySelector('.subject-grade-select');
                
                // Ensure there's a selected value, otherwise default to 0
                const hours = parseInt(hoursSelect.value || 0);
                const price = getPrice(hours);
                
                priceDisplay.textContent = `${formatCurrency(price)} ‡∏ö‡∏≤‡∏ó`;
                subtotal += price;

                const subjectName = nameInput.value || '‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏';
                const gradeText = gradeSelect.options[gradeSelect.selectedIndex].text;
                const hoursText = hoursSelect.options[hoursSelect.selectedIndex]?.text || '';
                
                let reviewText = subjectName;
                if (gradeSelect.value !== 'none') {
                    reviewText += ` (${gradeText})`;
                }
                if (hoursText) {
                    reviewText += ` (${hoursText})`;
                }
                

                const reviewItem = document.createElement('div');
                reviewItem.className = 'grid grid-cols-3 gap-4 py-2 border-b last:border-b-0 text-sm';
                reviewItem.innerHTML = `
                    <span class="col-span-2 text-gray-700">${reviewText}</span>
                    <span class="text-right font-medium text-gray-800">${formatCurrency(price)} ‡∏ö‡∏≤‡∏ó</span>
                `;
                reviewListContainer.appendChild(reviewItem);
            });

            if (allRows.length > 0) {
                reviewSection.classList.remove('hidden');
            } else {
                reviewSection.classList.add('hidden');
            }

            const discountPercent = parseFloat(discountPercentInput.value) || 0;
            const discountBaht = parseFloat(discountBahtInput.value) || 0;

            const discountPercentValue = (subtotal * discountPercent) / 100;
            const totalAfterPercent = subtotal - discountPercentValue;

            const actualDiscountBaht = Math.min(totalAfterPercent, discountBaht);
            let netTotal = totalAfterPercent - actualDiscountBaht;

            netTotal = Math.max(0, netTotal);

            subtotalDisplay.textContent = `${formatCurrency(subtotal)} ‡∏ö‡∏≤‡∏ó`;
            discountPercentValueDisplay.textContent = `- ${formatCurrency(discountPercentValue)} ‡∏ö‡∏≤‡∏ó`;
            discountBahtValueDisplay.textContent = `- ${formatCurrency(actualDiscountBaht)} ‡∏ö‡∏≤‡∏ó`;
            netTotalDisplay.textContent = `${formatCurrency(netTotal)} ‡∏ö‡∏≤‡∏ó`;
        }
        
        function resetForm() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                location.reload();
            }
        }
        
        function printQuote() {
            const today = new Date();
            document.getElementById('printDate').textContent = today.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            window.print();
        }
        
        function populateQuickAddPanel() {
            subjectNames.forEach(name => {
                const div = document.createElement('div');
                div.className = 'flex items-center';
                const id = `quickadd-${name.replace(/\s+/g, '-')}`;
                
                const input = document.createElement('input');
                input.type = 'checkbox';
                input.id = id;
                input.value = name;
                input.className = 'h-4 w-4 text-yellow-500 border-gray-300 rounded focus:ring-yellow-400';
                
                const label = document.createElement('label');
                label.htmlFor = id;
                label.textContent = name;
                label.className = 'ml-2 block text-sm text-gray-700 select-none';
                
                div.appendChild(input);
                div.appendChild(label);
                quickAddPanel.appendChild(div);
            });
        }

        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            populateQuickAddPanel();
            addRow('‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢', 200, 'p1'); // Add one starting row
        });

    </script>
</body>
</html>

