<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบคำนวณราคาแผนการสอน - ร้านครูพร้อมสอน</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-teal-600">ระบบคำนวณราคาแผนการสอน</h1>
            <p class="text-lg text-gray-600 mt-2">ร้านครูพร้อมสอน</p>
        </header>

        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
            
            <!-- Step 1: Selection Controls -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end mb-6 pb-6 border-b border-gray-200">
                <div class="md:col-span-1">
                    <label for="grade-select" class="block text-sm font-medium text-gray-700 mb-1">เลือกระดับชั้น</label>
                    <select id="grade-select" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block p-2.5">
                        <option selected disabled>-- กรุณาเลือก --</option>
                    </select>
                </div>
                <div class="md:col-span-2">
                    <label for="subject-select" class="block text-sm font-medium text-gray-700 mb-1">เลือกวิชา/กิจกรรม</label>
                    <select id="subject-select" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block p-2.5" disabled>
                        <option selected disabled>-- เลือกระดับชั้นก่อน --</option>
                    </select>
                </div>
                 <div class="md:col-span-1">
                    <label for="hours-select" class="block text-sm font-medium text-gray-700 mb-1">เลือกชั่วโมง</label>
                    <select id="hours-select" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block p-2.5" disabled>
                        <option selected disabled>-- เลือกวิชาก่อน --</option>
                    </select>
                </div>
            </div>
            
            <div class="text-center mb-6">
                 <button id="add-to-cart-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>
                    + เพิ่มรายการ
                </button>
            </div>

            <!-- Step 2: Cart / Selected Items -->
            <div class="mb-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">รายการที่เลือก</h2>
                <div id="cart-items" class="bg-gray-50 rounded-lg p-4 min-h-[100px]">
                    <p id="empty-cart-message" class="text-center text-gray-500">ยังไม่มีรายการที่เลือก</p>
                    <!-- Cart items will be injected here -->
                </div>
            </div>

            <!-- Step 3: Summary and Checkout -->
            <div class="bg-teal-50 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">สรุปยอด</h2>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">ราคารวม</span>
                        <span id="subtotal" class="font-bold text-lg">0.00 บาท</span>
                    </div>
                    <div class="flex justify-between items-center gap-4">
                        <label for="discount-input" class="text-gray-600 whitespace-nowrap">ส่วนลด (บาท)</label>
                        <input type="number" id="discount-input" min="0" placeholder="0" class="w-full max-w-[120px] text-right form-input border-gray-300 rounded-md shadow-sm focus:border-teal-500 focus:ring focus:ring-teal-500 focus:ring-opacity-50">
                    </div>
                    <div class="border-t border-gray-300 my-2"></div>
                    <div class="flex justify-between items-center text-2xl font-bold text-teal-700">
                        <span>ยอดสุทธิ</span>
                        <span id="total">0.00 บาท</span>
                    </div>
                </div>
                <div class="text-center mt-6">
                    <button id="reset-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg transition duration-300">
                        ล้างข้อมูล
                    </button>
                </div>
            </div>
        </div>
        
        <footer class="text-center mt-8 text-sm text-gray-500">
            <p>ออกแบบและพัฒนาสำหรับร้านครูพร้อมสอน</p>
        </footer>
    </div>

    <script>
        // Data structure for pricing based on the provided file
        const p1_p3_data = {
            "วิชาภาษาไทย": { "200": 350 },
            "วิชาภาษาอังกฤษ": { "160": 300, "200": 350 },
            "วิชาคณิตศาสตร์": { "200": 350 },
            "กิจกรรมรักการอ่าน": { "40": 200, "80": 250 },
            "กิจกรรมหนูน้อยนักเขียน": { "40": 200, "80": 250 },
            "กิจกรรมภาษาอังกฤษเพื่อการสื่อสาร": { "80": 250 },
            "กิจกรรมคณิตประยุกต์": { "80": 250 },
            "วิชาวิทยาศาสตร์และสิ่งแวดล้อม": { "40": 200, "80": 250 },
            "กิจกรรมการใช้เทคโนโลยีอย่างฉลาดรู้": { "40": 200, "80": 250 },
            "วิชาสังคมและความเป็นพลเมือง": { "40": 200, "80": 250 },
            "วิชาเศรษฐกิจและการเงิน": { "40": 200, "80": 250 },
            "วิชาสุขภาพกายและจิต": { "40": 200 },
            "วิชาศิลปะและวัฒนธรรมเพื่อสุนทรียภาพ": { "40": 200, "80": 250 }
        };

        const priceData = {
            "ป.1": p1_p3_data,
            "ป.2": p1_p3_data,
            "ป.3": p1_p3_data
        };

        // DOM Elements
        const gradeSelect = document.getElementById('grade-select');
        const subjectSelect = document.getElementById('subject-select');
        const hoursSelect = document.getElementById('hours-select');
        const addToCartBtn = document.getElementById('add-to-cart-btn');
        const cartItemsContainer = document.getElementById('cart-items');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const subtotalEl = document.getElementById('subtotal');
        const discountInput = document.getElementById('discount-input');
        const totalEl = document.getElementById('total');
        const resetBtn = document.getElementById('reset-btn');

        let cart = [];

        // --- Initialization ---
        function initialize() {
            populateGrades();
            gradeSelect.addEventListener('change', handleGradeChange);
            subjectSelect.addEventListener('change', handleSubjectChange);
            hoursSelect.addEventListener('change', handleHoursChange);
            addToCartBtn.addEventListener('click', handleAddToCart);
            discountInput.addEventListener('input', updateSummary);
            resetBtn.addEventListener('click', handleReset);
        }

        function populateGrades() {
            const grades = Object.keys(priceData);
            grades.forEach(grade => {
                const option = document.createElement('option');
                option.value = grade;
                option.textContent = grade;
                gradeSelect.appendChild(option);
            });
        }

        // --- Event Handlers ---
        function handleGradeChange() {
            const selectedGrade = gradeSelect.value;
            resetSelect(subjectSelect, '-- เลือกวิชา/กิจกรรม --');
            resetSelect(hoursSelect, '-- เลือกวิชาก่อน --');
            
            if (selectedGrade && priceData[selectedGrade]) {
                const subjects = Object.keys(priceData[selectedGrade]);
                subjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    subjectSelect.appendChild(option);
                });
                subjectSelect.disabled = false;
            } else {
                subjectSelect.disabled = true;
            }
            hoursSelect.disabled = true;
            addToCartBtn.disabled = true;
        }

        function handleSubjectChange() {
            const selectedGrade = gradeSelect.value;
            const selectedSubject = subjectSelect.value;
            resetSelect(hoursSelect, '-- เลือกชั่วโมง --');
            
            if (selectedGrade && selectedSubject && priceData[selectedGrade][selectedSubject]) {
                const hoursOptions = Object.keys(priceData[selectedGrade][selectedSubject]);
                hoursOptions.forEach(hours => {
                    const price = priceData[selectedGrade][selectedSubject][hours];
                    const option = document.createElement('option');
                    option.value = hours;
                    option.textContent = `${hours} ชม. (${price} บาท)`;
                    option.dataset.price = price;
                    hoursSelect.appendChild(option);
                });
                hoursSelect.disabled = false;
            } else {
                hoursSelect.disabled = true;
            }
            addToCartBtn.disabled = true;
        }
        
        function handleHoursChange() {
            if (hoursSelect.value) {
                addToCartBtn.disabled = false;
            } else {
                addToCartBtn.disabled = true;
            }
        }

        function handleAddToCart() {
            const grade = gradeSelect.value;
            const subject = subjectSelect.value;
            const hours = hoursSelect.value;
            
            if (!grade || !subject || !hours) return;
            
            const price = priceData[grade][subject][hours];
            
            const cartItem = {
                id: Date.now(), // Unique ID for removal
                grade,
                subject,
                hours: parseInt(hours),
                price: parseInt(price)
            };
            
            cart.push(cartItem);
            renderCart();
            updateSummary();
            
            // Reset selections for next entry
            subjectSelect.selectedIndex = 0;
            handleSubjectChange();
        }
        
        function handleReset() {
            cart = [];
            discountInput.value = '';
            gradeSelect.selectedIndex = 0;
            handleGradeChange();
            renderCart();
            updateSummary();
        }

        // --- UI Rendering and Calculation ---
        function renderCart() {
            if (cart.length === 0) {
                emptyCartMessage.style.display = 'block';
                cartItemsContainer.innerHTML = '';
                cartItemsContainer.appendChild(emptyCartMessage);
            } else {
                emptyCartMessage.style.display = 'none';
                cartItemsContainer.innerHTML = '';
                cart.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'flex justify-between items-center p-2 bg-white border-b border-gray-200';
                    itemEl.innerHTML = `
                        <div>
                            <p class="font-semibold">${item.subject} (${item.grade})</p>
                            <p class="text-sm text-gray-500">${item.hours} ชม.</p>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="font-medium">${item.price.toFixed(2)} บาท</span>
                            <button class="text-red-500 hover:text-red-700 font-bold" onclick="removeCartItem(${item.id})">&times;</button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(itemEl);
                });
            }
        }

        function removeCartItem(id) {
            cart = cart.filter(item => item.id !== id);
            renderCart();
            updateSummary();
        }

        function updateSummary() {
            const subtotal = cart.reduce((sum, item) => sum + item.price, 0);
            const discount = parseFloat(discountInput.value) || 0;
            const total = subtotal - discount;

            subtotalEl.textContent = `${subtotal.toFixed(2)} บาท`;
            totalEl.textContent = `${Math.max(0, total).toFixed(2)} บาท`;
        }

        function resetSelect(selectElement, defaultText) {
            selectElement.innerHTML = '';
            const defaultOption = document.createElement('option');
            defaultOption.textContent = defaultText;
            defaultOption.disabled = true;
            defaultOption.selected = true;
            selectElement.appendChild(defaultOption);
        }

        // --- Global Functions for inline onclick ---
        window.removeCartItem = removeCartItem;

        // --- Start the application ---
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
